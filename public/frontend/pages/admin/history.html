<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.0.1/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <!-- Navbar -->
    <nav class="bg-green-500 p-4 text-white">
        <div class="container mx-auto">
            <div class="flex justify-between">
                <div class="font-bold text-lg">
                   Eco-Responsable
                </div>
                <div>
                    <a href="http://localhost/eco-responsable/public/frontend/pages/login.html" class="mr-4">Home</a>
                    <a href="http://localhost/eco-responsable/public/frontend/pages/admin/history.html" class="mr-4">Update History</a>
                    <a href="http://localhost/eco-responsable/public/frontend/pages/admin/admin_dashboard.html" class="mr-4">Admin Dashboard</a>
                    <a href="http://localhost/eco-responsable/public/frontend/pages/admin/statistics.html" class="mr-4">Statistics</a>
                    <a href="#" id="logout-btn">Logout</a>
                </div>
            </div>
        </div>
    </nav>

    <section class="container mx-auto px-6 py-12">
        <h2 class="text-4xl font-bold text-center mb-8">Updates history</h2>
        <div id="adjustments-list" class="max-w-7xl mx-auto bg-white p-6 my-4 rounded-lg shadow-lg  overflow-x-scroll">
            <table class="w-full text-left border-collapse">
                <thead class="bg-green-500 text-white">
                    <tr>
                        <th class="border-b p-4">Date</th>
                        <th class="border-b p-4">Pseudo utilisateur</th>
                        <th class="border-b p-4">Admin</th>
                        <th class="border-b p-4">Previous Bottles Collected Weight</th>
                        <th class="border-b p-4">New Bottles Collected Weight</th>
                        <th class="border-b p-4">Previous withdrawal</th>
                        <th class="border-b p-4">New withdrawal</th>
                        <th class="border-b p-4">Previous profit</th>
                        <th class="border-b p-4">New profit</th>
                        <th class="border-b p-4">Previous accumulation</th>
                        <th class="border-b p-4">New accumulation</th>
                    </tr>
                </thead>
                <tbody id="adjustments-table-body">
                    <!-- Adjustments will be appended here -->
                </tbody>
            </table>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white text-center py-6">
        <p>&copy; 2024 Eco-Responsable. All rights reserved.</p>
    </footer>

    <div id="notification-container" class="fixed top-0 right-0 m-4"></div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('token');
            if (!token) {
                showNotification('You need to log in first.', 'error');
                window.location.href = 'login.html';
                return;
            }

            // Fetch score adjustment history
            const resAdjustments = await fetch('http://localhost:3000/api/history/adjustments', {
                headers: {
                    'x-auth-token': token
                }
            });

            if (resAdjustments.status !== 200) {
                showNotification('Failed to load score adjustment history.', 'error');
                return;
            }

            const adjustments = await resAdjustments.json();
            const adjustmentsTableBody = document.getElementById('adjustments-table-body');
            adjustmentsTableBody.innerHTML = '';

            adjustments.forEach(adjustment => {
                const adjustmentRow = document.createElement('tr');
                adjustmentRow.innerHTML = `
                    <td class="border-b p-4">${new Date(adjustment.adjustmentDate).toLocaleString()}</td>
                    <td class="border-b p-4">${adjustment.userId.username}</td>
                    <td class="border-b p-4">${adjustment.adminId.username}</td>
                    <td class="border-b p-4">${adjustment.previousBottlesCollectedWeight}Kg</td>
                    <td class="border-b p-4">${adjustment.newBottlesCollectedWeight}Kg</td>
                    <td class="border-b p-4">${adjustment.previouswithdrawal}</td>
                    <td class="border-b p-4">${adjustment.newWithdrawal}</td>
                    <td class="border-b p-4">${adjustment.previousprofit}</td>
                    <td class="border-b p-4">${adjustment.newprofit}</td>
                    <td class="border-b p-4">${adjustment.previousaccumulation}</td>
                    <td class="border-b p-4">${adjustment.newaccumulation}</td>
                `;
                adjustmentsTableBody.appendChild(adjustmentRow);
            });

            document.getElementById('logout-btn').addEventListener('click', () => {
                localStorage.removeItem('token');
                window.location.href = 'index.html';
            });

            // Function to show notification
            function showNotification(message, type) {
                const notificationContainer = document.getElementById('notification-container');
                const notification = document.createElement('div');
                notification.className = `p-4 mb-4 rounded-lg shadow-md ${type === 'error' ? 'bg-red-500 text-white' : 'bg-green-500 text-white'}`;
                notification.textContent = message;
                notificationContainer.appendChild(notification);

                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
        });
    </script>
</body>
</html>
